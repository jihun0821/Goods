<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>관리 페이지 - 구매목록 확인</title>
    <link rel="stylesheet" href="styles.css">

    <style>
      /* 관리용 테이블/컨트롤 추가 스타일 */
      .manage-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 16px;
        padding: 24px 40px;
        flex-wrap: wrap;
      }
      .manage-controls {
        display: flex;
        align-items: center;
        gap: 12px;
        flex-wrap: wrap;
      }
      .manage-controls input[type="search"],
      .manage-controls select,
      .manage-controls button {
        padding: 10px 12px;
        font-size: 16px;
        border: 2px solid #333;
        border-radius: 8px;
        font-family: 'Nanum Pen Script', cursive, sans-serif;
        background: white;
      }
      .manage-table-wrap {
        padding: 0 40px 40px 40px;
        overflow-x: auto;
      }
      table.manage-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 12px;
        background: white;
        border: 2px solid #333;
        border-radius: 8px;
        overflow: hidden;
      }
      table.manage-table thead th {
        background: #f0f0f0;
        padding: 12px;
        text-align: left;
        border-bottom: 2px solid #333;
        font-size: 14px;
      }
      table.manage-table tbody td {
        padding: 10px;
        border-bottom: 1px solid #eee;
        font-size: 14px;
        vertical-align: middle;
      }
      .small {
        font-size: 13px;
        color: #666;
      }
      .action-btn {
        padding: 6px 10px;
        border-radius: 6px;
        border: 2px solid #333;
        background: white;
        cursor: pointer;
        font-weight: bold;
      }
      .action-btn.danger {
        background: #e74c3c;
        color: white;
        border-color: #c0392b;
      }
      .no-data {
        padding: 40px;
        text-align: center;
        font-size: 18px;
      }
      .prod-thumb {
        width: 68px;
        height: 48px;
        object-fit: cover;
        border: 1px solid #ddd;
        border-radius: 4px;
      }

      /* 집계 패널 */
      .summary-wrap {
        display: flex;
        gap: 20px;
        padding: 0 40px 12px 40px;
        flex-wrap: wrap;
      }
      .summary-box {
        background: white;
        border: 2px solid #333;
        padding: 14px;
        border-radius: 8px;
        min-width: 280px;
      }
      .summary-box h3 {
        margin: 0 0 8px 0;
        font-size: 16px;
      }
      .summary-list {
        max-height: 220px;
        overflow: auto;
      }
      .summary-item {
        display: flex;
        justify-content: space-between;
        padding: 6px 0;
        border-bottom: 1px dashed #eee;
        font-size: 14px;
      }
      .summary-item:last-child { border-bottom: none; }
    </style>

    <script type="module">
      // firebase 모듈을 불러와서 window.firebase에 노출 (다른 페이지들과 호환)
      import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
      import { getAuth, onAuthStateChanged, signOut } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
      import { getFirestore, collection, getDocs, doc, deleteDoc } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

      window.firebase = {
        initializeApp,
        getAuth,
        onAuthStateChanged,
        signOut,
        getFirestore,
        collection,
        getDocs,
        doc,
        deleteDoc
      };
    </script>
</head>
<body>
    <!-- 메뉴 버튼 -->
    <div class="menu-button" onclick="toggleSidebar()">
        <span></span>
        <span></span>
        <span></span>
    </div>

    <!-- 오버레이 -->
    <div class="overlay" id="overlay" onclick="toggleSidebar()"></div>

    <!-- 사이드바 (기존 레이아웃 재사용) -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-section">
            <h2>사이트 이름</h2>
            <div class="login-box" onclick="location.href='index.html'">메인으로</div>
            <div class="login-box" id="loginButton" onclick="logout()">LOGOUT</div>
        </div>
        
        <div class="sidebar-section">
            <h2>회원 정보</h2>
            <ul class="option-list">
                <li id="userInfo">- 로그인이 필요합니다</li>
                <li style="cursor: pointer;" onclick="location.href='list.html'">- 내 구매목록</li>
                <li>- 사이트 설명</li>
            </ul>
        </div>

        <div class="sidebar-section">
            <ul class="option-list">
              <li style="cursor: pointer;" onclick="location.href='manage.html'">- 관리 페이지</li>
            </ul>
        </div>
    </div>

    <div class="main-content">
      <div class="manage-header">
        <h1 style="font-size: 28px; font-weight: normal;">구매 목록 (관리자 확인용)</h1>

        <div class="manage-controls">
          <label class="small">검색</label>
          <input id="searchInput" type="search" placeholder="제품명 / 구매자 이름 / 닉네임 / 학번 등으로 검색하세요" />

          <label class="small">필드</label>
          <select id="searchField">
            <option value="all">전체</option>
            <option value="productName">제품명</option>
            <option value="buyerName">구매자 이름 (privacy의 name)</option>
            <option value="nickname">닉네임 (privacy의 nickname)</option>
            <option value="studentNumber">학번</option>
          </select>

          <label class="small">정렬</label>
          <select id="sortSelect">
            <option value="purchaseDate_desc">구매일시 (최신)</option>
            <option value="purchaseDate_asc">구매일시 (오래된)</option>
            <option value="studentNumber_asc">학번 (오름차순)</option>
            <option value="studentNumber_desc">학번 (내림차순)</option>
            <option value="buyerName_asc">구매자 이름 (가나다)</option>
            <option value="buyerName_desc">구매자 이름 (역순)</option>
            <option value="productName_asc">제품명 (가나다)</option>
            <option value="productName_desc">제품명 (역순)</option>
          </select>

          <label class="small">제품 필터</label>
          <select id="productFilter">
            <option value="__all">전체 제품</option>
          </select>

          <label class="small">그룹화</label>
          <select id="groupBy">
            <option value="none">전체 합계</option>
            <option value="grade">학년별</option>
            <option value="class">반(학년+반)별</option>
          </select>

          <button id="clearFiltersBtn" class="action-btn">초기화</button>
        </div>
      </div>

      <!-- 요약(집계) 패널 -->
      <div class="summary-wrap">
        <div class="summary-box" id="productSummaryBox">
          <h3>제품별 요약 (표시된 결과 기준)</h3>
          <div class="summary-list" id="productSummaryList">
            <!-- 항목 동적 생성 -->
            <div class="small">로딩 중...</div>
          </div>
        </div>

        <div class="summary-box" id="groupSummaryBox">
          <h3>그룹별 합계</h3>
          <div class="summary-list" id="groupSummaryList">
            <div class="small">로딩 중...</div>
          </div>
        </div>
      </div>

      <div class="manage-table-wrap">
        <table class="manage-table" id="purchasesTable">
          <thead>
            <tr>
              <th style="width:140px">구매일시</th>
              <th style="width:120px">학번(숫자)</th>
              <th style="width:140px">구매자 (이름 / 닉네임)</th>
              <th style="width:220px">제품 (썸네일 / 이름)</th>
              <th style="width:80px">수량</th>
              <th style="width:100px">총액</th>
              <th style="width:90px">사이즈</th>
              <th style="width:140px">판매자</th>
              <th style="width:110px">액션</th>
            </tr>
          </thead>
          <tbody id="purchasesTbody">
            <tr><td colspan="9" class="no-data">로딩 중...</td></tr>
          </tbody>
        </table>
      </div>
    </div>

    <script src="manage.js" defer></script>
</body>
</html>